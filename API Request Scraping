import requests
import json
import pandas as pd

# This section is to generate each lawyer's code from the Json File

judul = []

for i in range(1,57,1):
  url = f'https://api.justika.com/lawyer/?page={i}'
  # Define headers used to request
  headers = {
            'Content-Type': 'application/json',
  }

  response = requests.get(url, headers=headers).json()
  data = json.dumps(response, indent=4)
  python_obj = json.loads(data)

  try:
    for j in range(0,10):
        judul.append((python_obj["results"][j]["code"]))
  except:
    pass
    
# This section is to insert each lawyer's code to the url, to generate json data for each lawyers in
# the next section

link = []
for j in judul:
  string = f"https://api.justika.com/lawyer/{j}/review/?page=1&page_size=5&score=3"
  link.append(string)

# This section is to get the 3-Stars feedback, order type, and post date from each lawyers

feedback = []
order_type = []
post_date = []

for k in link:
  r = requests.get(k,headers=headers).json()
  data = json.dumps(r, indent=4)
  python_obj_2 = json.loads(data)

  for x in python_obj_2["results"]:
    feedback.append(x["feedback"])
    order_type.append(x["order_type"])
    post_date.append(x["post_date"])

# This section is to generate the Feedback, order type, and post date and compile it in a dataframe

df = pd.DataFrame(feedback)
df["order_type"] = order_type
df["post_date"] = post_date
df.rename(columns={0:"Score_3"},inplace=True)
df = df[df["Score_3"]!=""].dropna()
df = df.replace("|","",regex=True)
df
